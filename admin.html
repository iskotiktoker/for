<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - АгроТрейд</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #27ae60;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --border: #bdc3c7;
        }

        body {
            background: linear-gradient(135deg, #1d976c 0%, #93f9b9 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .logo h1 {
            font-size: 2rem;
            color: var(--dark);
        }

        .admin-nav {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            background-color: var(--light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.active {
            background-color: var(--primary);
            color: white;
        }

        .nav-btn:hover:not(.active) {
            background-color: #e9ecef;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--light);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .logout-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        .admin-content {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--light);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card.users h3 {
            color: var(--info);
        }

        .stat-card.visitors h3 {
            color: var(--primary);
        }

        .stat-card.transactions h3 {
            color: var(--warning);
        }

        .stat-card.profit h3 {
            color: var(--secondary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background-color: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        .data-table tr:hover {
            background-color: rgba(39, 174, 96, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge.admin {
            background-color: var(--warning);
            color: white;
        }

        .badge.user {
            background-color: var(--info);
            color: white;
        }

        .badge.active {
            background-color: var(--primary);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border);
        }

        .export-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            background-color: var(--secondary);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 8px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: white;
        }

        .search-input {
            padding: 8px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            width: 250px;
        }

        .visitor-ip {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .user-agent {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .transaction-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .transaction-type.purchase {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .transaction-type.sale {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--info);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.5s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 1.5rem;
        }

        .notification.success {
            border-left: 4px solid var(--primary);
        }

        .notification.success i {
            color: var(--primary);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.error i {
            color: var(--danger);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--light);
            border-radius: 10px;
        }

        .chart-placeholder {
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            border: 2px dashed var(--border);
            color: var(--gray);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
                <h1>Админ-панель АгроТрейд</h1>
            </div>
            <div class="admin-nav">
                <button class="nav-btn active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i>Дашборд
                </button>
                <button class="nav-btn" data-tab="users">
                    <i class="fas fa-users"></i>Пользователи
                </button>
                <button class="nav-btn" data-tab="visitors">
                    <i class="fas fa-eye"></i>Посетители
                </button>
                <button class="nav-btn" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i>Транзакции
                </button>
            </div>
            <div class="user-info">
                <span id="admin-username">Администратор</span>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>Выйти
                </button>
            </div>
        </div>

        <!-- Дашборд -->
        <div class="admin-content tab-content active" id="dashboard-tab">
            <h2>Общая статистика</h2>
            
            <div class="stats-grid">
                <div class="stat-card users">
                    <h3 id="total-users">0</h3>
                    <p>Всего пользователей</p>
                </div>
                <div class="stat-card visitors">
                    <h3 id="total-visits">0</h3>
                    <p>Всего посещений</p>
                </div>
                <div class="stat-card transactions">
                    <h3 id="total-transactions">0</h3>
                    <p>Всего транзакций</p>
                </div>
                <div class="stat-card profit">
                    <h3 id="total-profit">0 ₽</h3>
                    <p>Общая прибыль</p>
                </div>
            </div>

            <div class="chart-container">
                <h3>Активность пользователей</h3>
                <div class="chart-placeholder">
                    <i class="fas fa-chart-bar"></i>
                    <span>График активности будет здесь</span>
                </div>
            </div>

            <div class="chart-container">
                <h3>Последние действия</h3>
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Время</th>
                                <th>Пользователь</th>
                                <th>Действие</th>
                                <th>IP-адрес</th>
                            </tr>
                        </thead>
                        <tbody id="recent-activities">
                            <!-- Данные будут загружены через JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Пользователи -->
        <div class="admin-content tab-content" id="users-tab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Управление пользователями</h2>
                <button class="export-btn" id="export-users">
                    <i class="fas fa-download"></i>Экспорт пользователей
                </button>
            </div>

            <div class="filters">
                <input type="text" class="search-input" id="user-search" placeholder="Поиск пользователей...">
                <select class="filter-select" id="user-role-filter">
                    <option value="all">Все роли</option>
                    <option value="admin">Администраторы</option>
                    <option value="user">Пользователи</option>
                </select>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Имя пользователя</th>
                            <th>Email</th>
                            <th>Роль</th>
                            <th>Дата регистрации</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="users-table">
                        <!-- Данные будут загружены через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Посетители -->
        <div class="admin-content tab-content" id="visitors-tab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>История посещений</h2>
                <button class="export-btn" id="export-visitors">
                    <i class="fas fa-download"></i>Экспорт посещений
                </button>
            </div>

            <div class="filters">
                <input type="date" class="filter-select" id="visit-date-from">
                <input type="date" class="filter-select" id="visit-date-to">
                <select class="filter-select" id="visit-type-filter">
                    <option value="all">Все посещения</option>
                    <option value="guest">Только гости</option>
                    <option value="user">Только пользователи</option>
                </select>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Время</th>
                            <th>Пользователь</th>
                            <th>IP-адрес</th>
                            <th>Браузер</th>
                            <th>Страница</th>
                        </tr>
                    </thead>
                    <tbody id="visitors-table">
                        <!-- Данные будут загружены через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Транзакции -->
        <div class="admin-content tab-content" id="transactions-tab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Все транзакции</h2>
                <button class="export-btn" id="export-transactions">
                    <i class="fas fa-download"></i>Экспорт транзакций
                </button>
            </div>

            <div class="filters">
                <input type="text" class="search-input" id="transaction-search" placeholder="Поиск по товару...">
                <select class="filter-select" id="transaction-type-filter">
                    <option value="all">Все типы</option>
                    <option value="purchase">Закупки</option>
                    <option value="sale">Продажи</option>
                </select>
                <select class="filter-select" id="transaction-user-filter">
                    <option value="all">Все пользователи</option>
                </select>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Дата</th>
                            <th>Пользователь</th>
                            <th>Тип</th>
                            <th>Товар</th>
                            <th>Количество</th>
                            <th>Цена</th>
                            <th>Сумма</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-table">
                        <!-- Данные будут загружены через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div class="notification-content">
            <h4>Успешно!</h4>
            <p>Операция выполнена</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const navBtns = document.querySelectorAll('.nav-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const logoutBtn = document.getElementById('logout-btn');
            const notification = document.getElementById('notification');
            
            // Проверка авторизации
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token || !user.isAdmin) {
                window.location.href = 'login.html';
                return;
            }
            
            // Установка имени администратора
            document.getElementById('admin-username').textContent = user.username;
            
            // Навигация по вкладкам
            navBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Активация кнопки вкладки
                    navBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Активация контента вкладки
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Загрузка данных для активной вкладки
                    loadTabData(tabId);
                });
            });
            
            // Выход из системы
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            });
            
            // Загрузка данных для активной вкладки
            function loadTabData(tabId) {
                switch(tabId) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'users':
                        loadUsersData();
                        break;
                    case 'visitors':
                        loadVisitorsData();
                        break;
                    case 'transactions':
                        loadTransactionsData();
                        break;
                }
            }
            
            // Загрузка данных дашборда
            async function loadDashboardData() {
                try {
                    // Загрузка пользователей
                    const usersResponse = await fetch('/admin/users', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const users = await usersResponse.json();
                    
                    // Загрузка посещений
                    const visitorsResponse = await fetch('/admin/visitors', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const visitors = await visitorsResponse.json();
                    
                    // Загрузка транзакций
                    const transactionsResponse = await fetch('/admin/all-transactions', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const allTransactions = await transactionsResponse.json();
                    
                    // Обновление статистики
                    document.getElementById('total-users').textContent = users.length;
                    document.getElementById('total-visits').textContent = visitors.length;
                    
                    let totalTransactions = 0;
                    let totalProfit = 0;
                    
                    Object.values(allTransactions).forEach(userTransactions => {
                        totalTransactions += userTransactions.length;
                        
                        userTransactions.forEach(transaction => {
                            if (transaction.type === 'sale') {
                                totalProfit += transaction.total;
                            } else if (transaction.type === 'purchase') {
                                totalProfit -= transaction.total;
                            }
                        });
                    });
                    
                    document.getElementById('total-transactions').textContent = totalTransactions;
                    document.getElementById('total-profit').textContent = `${totalProfit.toFixed(2)} ₽`;
                    
                    // Обновление последних действий
                    updateRecentActivities(visitors);
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    showNotification('Ошибка загрузки данных', 'error');
                }
            }
            
            // Загрузка данных пользователей
            async function loadUsersData() {
                try {
                    const response = await fetch('/admin/users', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const users = await response.json();
                    
                    updateUsersTable(users);
                    setupUsersFilters(users);
                    
                } catch (error) {
                    console.error('Error loading users data:', error);
                    showNotification('Ошибка загрузки пользователей', 'error');
                }
            }
            
            // Загрузка данных посещений
            async function loadVisitorsData() {
                try {
                    const response = await fetch('/admin/visitors', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const visitors = await response.json();
                    
                    updateVisitorsTable(visitors);
                    setupVisitorsFilters(visitors);
                    
                } catch (error) {
                    console.error('Error loading visitors data:', error);
                    showNotification('Ошибка загрузки посещений', 'error');
                }
            }
            
            // Загрузка данных транзакций
            async function loadTransactionsData() {
                try {
                    const response = await fetch('/admin/all-transactions', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const allTransactions = await response.json();
                    
                    updateTransactionsTable(allTransactions);
                    setupTransactionsFilters(allTransactions);
                    
                } catch (error) {
                    console.error('Error loading transactions data:', error);
                    showNotification('Ошибка загрузки транзакций', 'error');
                }
            }
            
            // Обновление таблицы последних действий
            function updateRecentActivities(visitors) {
                const tbody = document.getElementById('recent-activities');
                const recentVisitors = visitors.slice(-10).reverse();
                
                tbody.innerHTML = '';
                
                if (recentVisitors.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>Нет данных о действиях</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                recentVisitors.forEach(visit => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDateTime(visit.timestamp)}</td>
                        <td>${visit.username || 'Гость'}</td>
                        <td>${getActionDescription(visit.endpoint)}</td>
                        <td><span class="visitor-ip">${visit.ip}</span></td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Обновление таблицы пользователей
            function updateUsersTable(users) {
                const tbody = document.getElementById('users-table');
                
                tbody.innerHTML = '';
                
                if (users.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="empty-state">
                                <i class="fas fa-users"></i>
                                <p>Нет зарегистрированных пользователей</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email || 'Не указан'}</td>
                        <td><span class="badge ${user.isAdmin ? 'admin' : 'user'}">${user.isAdmin ? 'Админ' : 'Пользователь'}</span></td>
                        <td>${formatDate(user.createdAt)}</td>
                        <td>
                            <button class="nav-btn" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Обновление таблицы посещений
            function updateVisitorsTable(visitors) {
                const tbody = document.getElementById('visitors-table');
                const sortedVisitors = [...visitors].reverse();
                
                tbody.innerHTML = '';
                
                if (sortedVisitors.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <i class="fas fa-eye"></i>
                                <p>Нет данных о посещениях</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                sortedVisitors.forEach(visit => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDateTime(visit.timestamp)}</td>
                        <td>${visit.username || 'Гость'}</td>
                        <td><span class="visitor-ip">${visit.ip}</span></td>
                        <td><span class="user-agent" title="${visit.userAgent}">${visit.userAgent}</span></td>
                        <td>${visit.endpoint}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Обновление таблицы транзакций
            function updateTransactionsTable(allTransactions) {
                const tbody = document.getElementById('transactions-table');
                const allTransactionsFlat = [];
                
                // Преобразование объекта в плоский массив
                Object.entries(allTransactions).forEach(([userId, transactions]) => {
                    transactions.forEach(transaction => {
                        allTransactionsFlat.push({
                            ...transaction,
                            userId: userId
                        });
                    });
                });
                
                // Сортировка по дате (новые сначала)
                allTransactionsFlat.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                tbody.innerHTML = '';
                
                if (allTransactionsFlat.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-state">
                                <i class="fas fa-exchange-alt"></i>
                                <p>Нет данных о транзакциях</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Товары
                const products = {
                    cherry: 'Вишня',
                    strawberry: 'Клубника',
                    raspberry: 'Малина',
                    blueberry: 'Черника',
                    apple: 'Яблоки',
                    pear: 'Груши',
                    plum: 'Сливы',
                    other: 'Другой товар'
                };
                
                // Единицы измерения
                const units = {
                    kg: 'кг',
                    g: 'г',
                    pcs: 'шт',
                    box: 'ящ',
                    crate: 'кор'
                };
                
                allTransactionsFlat.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDate(transaction.date)}</td>
                        <td>${transaction.userId}</td>
                        <td>
                            <span class="transaction-type ${transaction.type}">
                                ${transaction.type === 'purchase' ? 'Закупка' : 'Продажа'}
                            </span>
                        </td>
                        <td>${products[transaction.product] || transaction.product}</td>
                        <td>${transaction.amount} ${units[transaction.unit] || transaction.unit}</td>
                        <td>${transaction.price} ₽</td>
                        <td>${transaction.total.toFixed(2)} ₽</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Настройка фильтров для пользователей
            function setupUsersFilters(users) {
                const searchInput = document.getElementById('user-search');
                const roleFilter = document.getElementById('user-role-filter');
                
                const filterUsers = () => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const roleValue = roleFilter.value;
                    
                    const filteredUsers = users.filter(user => {
                        const matchesSearch = user.username.toLowerCase().includes(searchTerm) ||
                                             user.email.toLowerCase().includes(searchTerm);
                        
                        const matchesRole = roleValue === 'all' ||
                                           (roleValue === 'admin' && user.isAdmin) ||
                                           (roleValue === 'user' && !user.isAdmin);
                        
                        return matchesSearch && matchesRole;
                    });
                    
                    updateUsersTable(filteredUsers);
                };
                
                searchInput.addEventListener('input', filterUsers);
                roleFilter.addEventListener('change', filterUsers);
            }
            
            // Настройка фильтров для посещений
            function setupVisitorsFilters(visitors) {
                // Реализация фильтров для посещений
                // (аналогично фильтрам для пользователей)
            }
            
            // Настройка фильтров для транзакций
            function setupTransactionsFilters(allTransactions) {
                // Реализация фильтров для транзакций
                // (аналогично фильтрам для пользователей)
            }
            
            // Вспомогательные функции
            function formatDate(dateString) {
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                return new Date(dateString).toLocaleDateString('ru-RU', options);
            }
            
            function formatDateTime(dateString) {
                const options = { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                return new Date(dateString).toLocaleDateString('ru-RU', options);
            }
            
            function getActionDescription(endpoint) {
                const actions = {
                    '/': 'Посещение главной страницы',
                    '/login': 'Вход в систему',
                    '/register': 'Регистрация',
                    '/admin': 'Доступ к админ-панели'
                };
                
                return actions[endpoint] || `Посещение ${endpoint}`;
            }
            
            function showNotification(message, type = 'success') {
                const notificationContent = notification.querySelector('.notification-content');
                notificationContent.innerHTML = `
                    <h4>${type === 'success' ? 'Успешно!' : 'Ошибка!'}</h4>
                    <p>${message}</p>
                `;
                
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Глобальные функции для кнопок действий
            window.editUser = function(userId) {
                showNotification(`Редактирование пользователя ${userId}`, 'success');
                // Здесь можно добавить логику редактирования пользователя
            };
            
            // Экспорт данных
            document.getElementById('export-users').addEventListener('click', function() {
                showNotification('Экспорт пользователей начат', 'success');
            });
            
            document.getElementById('export-visitors').addEventListener('click', function() {
                showNotification('Экспорт посещений начат', 'success');
            });
            
            document.getElementById('export-transactions').addEventListener('click', function() {
                showNotification('Экспорт транзакций начат', 'success');
            });
            
            // Загрузка данных для активной вкладки при загрузке страницы
            loadTabData('dashboard');
        });
    </script>
</body>
</html>